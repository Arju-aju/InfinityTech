<%- include('./partials/adminHeader.ejs') %>

<div class="flex h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900">
    <%- include('./partials/adminSidebar.ejs') %>

    <main class="flex-1 overflow-x-hidden overflow-y-auto">
        <div class="container mx-auto px-6 py-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-gray-100 text-3xl font-medium">Products</h3>
                <a href="/admin/addProduct" class="btn-primary">
                    <i class="fas fa-plus mr-2"></i>Add Product
                </a>
            </div>

            <!-- Products Grid -->
            <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                <% products.forEach(product => { %>
                    <div class="glass-effect rounded-xl overflow-hidden">
                        <div class="relative pb-48 overflow-hidden">
                            <img class="absolute inset-0 h-full w-full object-cover" 
                                 src="<%= product.images[0] || '/images/placeholder.jpg' %>" 
                                 alt="<%= product.name %>">
                            <% if (product.discountPercentage) { %>
                                <div class="absolute top-0 right-0 bg-red-500/80 backdrop-blur-sm text-white px-2 py-1 m-2 rounded-md text-sm">
                                    -<%= product.discountPercentage %>%
                                </div>
                            <% } %>
                            <div class="absolute top-0 left-0 bg-cyan-500/80 backdrop-blur-sm text-white px-2 py-1 m-2 rounded-md text-sm">
                                <%= product.brand %>
                            </div>
                            <div class="absolute bottom-0 left-0 right-0 px-2 py-1 m-2 rounded-md text-sm text-center
                                        <%= product.stock < 6 ? 'bg-red-500/80' : 'bg-green-500/80' %> backdrop-blur-sm text-white">
                                <%= product.stock < 6 ? 'Out of Stock' : 'In Stock' %>
                            </div>
                        </div>
                        <div class="p-4">
                            <h2 class="text-xl font-semibold text-gray-100"><%= product.name %></h2>
                            <p class="text-gray-300 mt-2 truncate"><%= product.description %></p>
                            <div class="mt-3 flex items-center">
                                <span class="text-cyan-400 font-bold text-xl">$<%= product.discountedPrice || product.price %></span>
                                <% if (product.discountedPrice) { %>
                                    <span class="text-gray-400 line-through text-sm ml-2">$<%= product.price %></span>
                                <% } %>
                            </div>
                            <div class="mt-3 flex items-center text-sm text-gray-300">
                                <i class="fas fa-box-open mr-2"></i>
                                <span>Stock: <%= product.stock %></span>
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <a href="/admin/editProduct/<%= product._id %>" 
                                   class="text-cyan-400 hover:text-cyan-300 transition-colors duration-300">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </a>
                                <button onclick="confirmDelete('<%= product._id %>')" 
                                        class="text-red-400 hover:text-red-300 transition-colors duration-300">
                                    <i class="fas fa-trash-alt mr-1"></i>Delete
                                </button>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>

            <!-- Pagination -->
            <div class="flex items-center justify-between mt-8">
                <div class="text-sm text-gray-400">
                    Showing <span class="font-medium"><%= ((currentPage - 1) * limit) + 1 %></span> to 
                    <span class="font-medium"><%= Math.min(currentPage * limit, totalProducts) %></span> of 
                    <span class="font-medium"><%= totalProducts %></span> results
                </div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <% if (currentPage > 1) { %>
                        <a href="/admin/products?page=<%= currentPage - 1 %>&limit=<%= limit %>" 
                           class="relative inline-flex items-center px-4 py-2 rounded-l-md glass-effect text-sm text-gray-200 hover:bg-gray-700/50 transition-all duration-300">
                            <i class="fas fa-chevron-left mr-1"></i>
                            Previous
                        </a>
                    <% } %>

                    <% if (currentPage < totalPages) { %>
                        <a href="/admin/products?page=<%= currentPage + 1 %>&limit=<%= limit %>"
                           class="relative inline-flex items-center px-4 py-2 rounded-r-md glass-effect text-sm text-gray-200 hover:bg-gray-700/50 transition-all duration-300">
                            Next
                            <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    <% } %>
                </nav>
            </div>

        </div>
    </main>

    <!-- Decorative Elements -->
    <div class="fixed top-0 left-0 w-full h-full pointer-events-none overflow-hidden -z-10">
        <div class="absolute top-1/4 left-1/4 w-72 h-72 bg-cyan-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob"></div>
        <div class="absolute top-1/3 right-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-2000"></div>
        <div class="absolute bottom-1/4 left-1/3 w-80 h-80 bg-indigo-500 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-blob animation-delay-4000"></div>
    </div>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Delete Product Script -->
<script>
function confirmDelete(productId) {
    Swal.fire({
        title: 'Are you sure?',
        text: "This product will be permanently deleted!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/admin/deleteProduct/${productId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        title: 'Deleted!',
                        text: data.message,
                        icon: 'success'
                    }).then(() => {
                        window.location.reload();
                    });
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                Swal.fire({
                    title: 'Error!',
                    text: error.message || 'Failed to delete product',
                    icon: 'error'
                });
            });
        }
    });
}
</script>

<%- include('./partials/adminFooter.ejs') %>