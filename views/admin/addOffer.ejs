<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= editing ? 'Edit Offer' : 'Add Offer' %></title>
    <%- include('./partials/adminHeader.ejs') %>
</head>

<body class="gradient-bg animate-gradient min-h-screen flex">
    <%- include('./partials/adminSidebar.ejs') %>

    <div class="flex-1 flex flex-col overflow-hidden" style="margin-left: var(--sidebar-width, 16rem);">
        <main class="flex-1 overflow-x-hidden overflow-y-auto p-6">
            <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
                <!-- Header Section -->
                <div class="flex justify-between items-center mb-8 animate-fade-in-up">
                    <h1 class="text-3xl font-extrabold bg-gradient-to-r from-[#d4af37] to-[#f9e076] bg-clip-text text-transparent tracking-tight">
                        <%= editing ? 'Edit Offer' : 'Add Offer' %>
                    </h1>
                    <a href="/admin/offers" 
                       class="inline-flex items-center px-4 py-2 rounded-lg bg-gradient-to-r from-[#d4af37] to-[#f9e076] text-white transition-all duration-300 transform hover:scale-105 group glass-effect-dark">
                        <svg class="w-5 h-5 mr-2 transition-transform duration-300 group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path>
                        </svg>
                        Back to Offers
                    </a>
                </div>

                <!-- Error Message -->
                <% if (errorMessage) { %>
                    <div class="bg-red-900/80 backdrop-blur-md text-red-300 p-4 rounded-lg mb-6 border border-red-700/50 animate-fade-in-up animation-delay-200">
                        <%= errorMessage %>
                    </div>
                <% } %>

                <!-- Form Section -->
                <div class="glass-effect-dark rounded-xl p-8 shadow-xl border border-white/10 animate-fade-in-up animation-delay-400">
                    <form method="POST" 
                          action="<%= editing ? '/admin/offers/edit/' + offer._id : '/admin/offers/add?type=' + (offer.Product && offer.Product.length > 0 ? 'product' : 'category') %>"
                          class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Offer Name</label>
                                <input type="text" name="name" 
                                       value="<%= editing ? offer.name : (oldInput.name || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] placeholder-gray-500 focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       placeholder="Enter offer name" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Description</label>
                                <input type="text" name="description" 
                                       value="<%= editing ? offer.description : (oldInput.description || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] placeholder-gray-500 focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       placeholder="Enter description">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Discount Type</label>
                                <select name="discountType" 
                                        class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]" 
                                        required>
                                    <option value="percentage" <%= editing && offer.discountType === 'percentage' ? 'selected' : '' %>>Percentage</option>
                                    <option value="fixed" <%= editing && offer.discountType === 'fixed' ? 'selected' : '' %>>Fixed</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Discount Value</label>
                                <input type="number" name="discountValue" 
                                       value="<%= editing ? offer.discountValue : (oldInput.discountValue || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] placeholder-gray-500 focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       placeholder="Enter discount value" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Max Discount (optional)</label>
                                <input type="number" name="maxDiscount" 
                                       value="<%= editing && offer.maxDiscount ? offer.maxDiscount : (oldInput.maxDiscount || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] placeholder-gray-500 focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       placeholder="Enter max discount">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Minimum Amount</label>
                                <input type="number" name="minimumAmount" 
                                       value="<%= editing ? offer.minimumAmount : (oldInput.minimumAmount || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] placeholder-gray-500 focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       placeholder="Enter minimum amount">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Start Date</label>
                                <input type="date" name="startDate" 
                                       value="<%= editing ? offer.startDate.toISOString().split('T')[0] : (oldInput.startDate || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-[var(--text-color)] mb-2">End Date</label>
                                <input type="date" name="endDate" 
                                       value="<%= editing ? offer.endDate.toISOString().split('T')[0] : (oldInput.endDate || '') %>"
                                       class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]"
                                       required>
                            </div>
                            <% if (!editing || (editing && offer.Product.length > 0)) { %>
                                <div>
                                    <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Products</label>
                                    <select name="product" multiple 
                                            class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]">
                                        <% products.forEach(prod => { %>
                                            <option value="<%= prod._id %>" <%= editing && offer.Product.some(p => p._id.toString() === prod._id.toString()) ? 'selected' : '' %>>
                                                <%= prod.name %>
                                            </option>
                                        <% }) %>
                                    </select>
                                </div>
                            <% } %>
                            <% if (!editing || (editing && offer.Categories.length > 0)) { %>
                                <div>
                                    <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Category</label>
                                    <select name="category" 
                                            class="w-full px-4 py-3 rounded-lg bg-[var(--content-bg)] border border-white/10 text-[var(--text-color)] focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/20 transition-all duration-300 hover:bg-[var(--secondary-bg)]">
                                        <option value="">Select a category</option>
                                        <% categories.forEach(cat => { %>
                                            <option value="<%= cat._id %>" <%= editing && offer.Categories.length > 0 && offer.Categories[0]._id.toString() === cat._id.toString() ? 'selected' : '' %>>
                                                <%= cat.name %>
                                            </option>
                                        <% }) %>
                                    </select>
                                </div>
                            <% } %>
                            <% if (editing) { %>
                                <div>
                                    <label class="block text-sm font-medium text-[var(--text-color)] mb-2">Active</label>
                                    <input type="checkbox" name="isActive" <%= offer.isActive ? 'checked' : '' %>
                                           class="h-5 w-5 text-[#d4af37] bg-[var(--content-bg)] border border-white/10 rounded focus:ring-[#d4af37] focus:ring-2">
                                </div>
                            <% } %>
                        </div>
                        <div class="flex justify-end mt-6">
                            <button type="submit" 
                                    class="inline-flex items-center px-6 py-3 rounded-lg bg-gradient-to-r from-[#d4af37] to-[#f9e076] text-white font-medium transition-all duration-300 transform hover:scale-105 group">
                                <svg class="w-5 h-5 mr-2 transition-transform duration-300 group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Save Offer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <%- include('./partials/adminFooter.ejs') %>
</body>
</html>